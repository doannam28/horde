{"remainingRequest":"D:\\Project VMODEV\\Horde\\oui\\oui-master\\oui-ui-core\\src\\node_modules\\babel-loader\\lib\\index.js!D:\\Project VMODEV\\Horde\\oui\\oui-master\\oui-ui-core\\src\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\Project VMODEV\\Horde\\oui\\oui-master\\oui-ui-core\\src\\src\\components\\uci-form\\src\\uci-section.js","dependencies":[{"path":"D:\\Project VMODEV\\Horde\\oui\\oui-master\\oui-ui-core\\src\\src\\components\\uci-form\\src\\uci-section.js","mtime":1591674512000},{"path":"D:\\Project VMODEV\\Horde\\oui\\oui-master\\oui-ui-core\\src\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Project VMODEV\\Horde\\oui\\oui-master\\oui-ui-core\\src\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\Project VMODEV\\Horde\\oui\\oui-master\\oui-ui-core\\src\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _toConsumableArray from \"D:\\\\Project VMODEV\\\\Horde\\\\oui\\\\oui-master\\\\oui-ui-core\\\\src\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/es6.regexp.split\";\nimport _slicedToArray from \"D:\\\\Project VMODEV\\\\Horde\\\\oui\\\\oui-master\\\\oui-ui-core\\\\src\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/slicedToArray\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.array.sort\";\nimport UciFormItem from \"./uci-form-item\";\nimport UciSectionAdd from \"./uci-section-add\";\nexport default {\n  name: 'UciSection',\n  provide: function provide() {\n    return {\n      uciSection: this\n    };\n  },\n  inject: ['uciForm'],\n  props: {\n    /*\n    ** The 'type' and 'name' must be provided at least one.\n    ** If the name prop is provided, only the section whose name is equal to the name prop is rendered,\n    ** otherwise render all sections whose type is equal to the type prop.\n    */\n    type: String,\n    name: String,\n    title: String,\n\n    /* The type prop must be provided for add or delete */\n    addable: Boolean,\n\n    /* If false, the add operation will add a named section */\n    anonymous: {\n      type: Boolean,\n      default: true\n    },\n\n    /* Render in a table */\n    table: Boolean,\n\n    /* Parameters: uci section, self */\n    filter: Function,\n    options: {\n      type: Object,\n      default: function _default() {}\n    },\n\n    /* Custom add function */\n    add: Function,\n\n    /* hook after add */\n    afterAdd: Function,\n\n    /* hook before del */\n    beforeDel: Function,\n    collabsible: {\n      type: Boolean,\n      default: true\n    },\n    teasers: Array,\n    sortable: Boolean\n  },\n  components: {\n    UciFormItem: UciFormItem,\n    UciSectionAdd: UciSectionAdd\n  },\n  data: function data() {\n    return {\n      loaded: false,\n\n      /* Indicates whether the data is loaded */\n      tabs: [],\n\n      /* uci-tab vue instances */\n      children: {},\n\n      /* uci-option vue instances */\n      sections: [],\n\n      /* uci sections */\n      activeCollapseItem: ''\n    };\n  },\n  computed: {\n    config: function config() {\n      return this.uciForm.config;\n    },\n    tableExpandTabs: function tableExpandTabs() {\n      return this.tabs.filter(function (tab) {\n        return tab.isTableExpand;\n      });\n    },\n    arrayedOptions: function arrayedOptions() {\n      var _this = this;\n\n      return Object.keys(this.children).map(function (name) {\n        return _this.children[name];\n      }).sort(function (a, b) {\n        return a.uid - b.uid;\n      }).filter(function (o) {\n        return !o.isTableExpand;\n      });\n    },\n    arrayedTableExpandOptions: function arrayedTableExpandOptions() {\n      var _this2 = this;\n\n      return Object.keys(this.children).map(function (name) {\n        return _this2.children[name];\n      }).sort(function (a, b) {\n        return a.uid - b.uid;\n      }).filter(function (o) {\n        return o.isTableExpand;\n      });\n    },\n    sids: function sids() {\n      var _this3 = this;\n\n      var sections = [];\n      if (this.name) sections = this.sections.filter(function (s) {\n        return s['.name'] === _this3.name;\n      });else if (this.type) sections = this.sections;\n      if (this.filter) sections = sections.filter(function (s) {\n        return _this3.filter(s, _this3);\n      });\n      return sections.map(function (s) {\n        return s['.name'];\n      });\n    },\n    tableActionWidthCalc: function tableActionWidthCalc() {\n      if (this.tableActionWidth) return this.tableActionWidth;\n      if (this.sortable) return '150';\n      return '70';\n    }\n  },\n  watch: {\n    'uciForm.loaded': function uciFormLoaded() {\n      this.load();\n    }\n  },\n  methods: {\n    formValue: function formValue(name, sid) {\n      var o = this.children[name];\n      if (o) return o.formValue(sid);\n      return undefined;\n    },\n    setFormValue: function setFormValue(name, sid, val) {\n      var o = this.children[name];\n      if (o) o.setFormValue(sid, val);\n    },\n    addChild: function addChild(o) {\n      this.$set(this.children, o.name, o);\n    },\n    delChild: function delChild(o) {\n      var d = this.children[o.name];\n      if (d && d.uid === o.uid) this.$delete(this.children, o.name);\n    },\n    load: function load() {\n      this.sections = this.$uci.sections(this.config, this.type);\n      this.loaded = true;\n    },\n    buildForm: function buildForm(sid) {\n      for (var name in this.children) {\n        this.children[name].buildForm(sid);\n      }\n    },\n    destroyForm: function destroyForm(sid) {\n      for (var name in this.children) {\n        this.children[name].destroyFormSid(sid);\n      }\n    },\n    loadAdded: function loadAdded(sid) {\n      this.activeCollapseItem = sid;\n      this.load();\n      this.buildForm(sid);\n    },\n    performDel: function performDel(sid) {\n      this.$uci.del(this.config, sid);\n      this.load();\n      this.destroyForm(sid);\n    },\n    del: function del(sid) {\n      var _this4 = this;\n\n      if (this.beforeDel) {\n        var before = this.beforeDel(sid, this);\n        if (before === false) return;\n\n        if (window.oui.isPromise(before)) {\n          before.then(function () {\n            _this4.performDel(sid);\n          }, function () {\n            /* ignore promise rejection */\n          });\n          return;\n        }\n      }\n\n      this.performDel(sid);\n    },\n    swap: function swap(sid1, sid2) {\n      this.$uci.swap(this.config, sid1, sid2);\n      this.load();\n    },\n    teasersValue: function teasersValue(sid) {\n      var _this5 = this;\n\n      var teasers = [];\n\n      if (this.teasers) {\n        this.teasers.forEach(function (name) {\n          var o = _this5.children[name];\n          teasers.push([o.label, o.textValue(sid)]);\n        });\n      } else {\n        for (var name in this.children) {\n          var o = this.children[name];\n          var v = o.textValue(sid);\n          teasers.push([o.label, v]);\n        }\n      }\n\n      if (teasers.length > 0) teasers[teasers.length - 1].push('end');\n      return teasers;\n    },\n    getErrorNum: function getErrorNum() {\n      var _this6 = this;\n\n      var validates = this.uciForm.validates;\n      var keys = Object.keys(validates).filter(function (key) {\n        var _key$split = key.split('_'),\n            _key$split2 = _slicedToArray(_key$split, 1),\n            sid = _key$split2[0];\n\n        return _this6.sids.indexOf(sid) > -1 && !validates[key].valid;\n      });\n      return keys.length;\n    },\n    save: function save() {\n      var _this7 = this;\n\n      var promises = [];\n      this.sids.forEach(function (sid) {\n        for (var name in _this7.children) {\n          var p = _this7.children[name]._save(sid);\n\n          if (window.oui.isPromise(p)) promises.push(p);\n        }\n      });\n      return promises;\n    },\n    apply: function apply() {\n      var _this8 = this;\n\n      var promises = [];\n      this.sids.forEach(function (sid) {\n        for (var name in _this8.children) {\n          var p = _this8.children[name]._apply(sid);\n\n          if (window.oui.isPromise(p)) promises.push(p);\n        }\n      });\n      return promises;\n    },\n    applied: function applied() {\n      var _this9 = this;\n\n      this.sids.forEach(function (sid) {\n        for (var name in _this9.children) {\n          _this9.children[name].applied(sid);\n        }\n      });\n    },\n    handleSort: function handleSort(sid, up) {\n      var sids = this.sids;\n      var index = sids.indexOf(sid);\n      if (up) index--;else index++;\n      if (index < 0 || index === sids.length) return;\n      var nsid = sids[index];\n      this.swap(sid, nsid);\n    },\n    sectionView: function sectionView(sid, divider) {\n      var h = this.$createElement;\n      var views = [];\n      if (this.addable && this.type && !this.name) views.push(h(\"el-row\", [h(\"el-button\", {\n        \"style\": \"float:right\",\n        \"attrs\": {\n          \"type\": \"danger\",\n          \"size\": \"mini\"\n        },\n        \"on\": {\n          \"click\": this.del.bind(this, sid)\n        }\n      }, [this.$t('Delete')])]));\n\n      if (this.tabs.length > 0) {\n        var tabPanes = this.tabs.map(function (tab) {\n          var errNum = tab.getErrorNum(sid);\n          return h(\"el-tab-pane\", {\n            \"attrs\": {\n              \"name\": tab.name\n            }\n          }, [h(\"span\", {\n            \"slot\": \"label\"\n          }, [tab.title, errNum > 0 && h(\"el-badge\", {\n            \"attrs\": {\n              \"value\": errNum\n            }\n          })]), tab.options.map(function (o) {\n            return h(\"uci-form-item\", {\n              \"attrs\": {\n                \"option\": o,\n                \"sid\": sid\n              }\n            });\n          })]);\n        });\n        views.push(h(\"el-tabs\", {\n          \"attrs\": {\n            \"value\": this.tabs[0].name\n          }\n        }, [tabPanes]));\n      }\n\n      var noTabOptions = this.arrayedOptions.filter(function (o) {\n        return !o.tabName;\n      });\n      views.push(noTabOptions.map(function (o) {\n        return h(\"uci-form-item\", {\n          \"attrs\": {\n            \"option\": o,\n            \"sid\": sid\n          }\n        });\n      }));\n      if (divider) views.push(h(\"el-divider\"));\n      return views;\n    },\n    tableView: function tableView() {\n      var _this10 = this;\n\n      var h = this.$createElement;\n      var columns = [];\n      /* If don't do this, an exception occurs when rendering the expandable table. */\n\n      if (this.arrayedOptions.length < 1) return undefined;\n\n      if (this.arrayedTableExpandOptions.length > 0) {\n        var scopedSlots = {\n          default: function _default(props) {\n            var sid = props.row;\n            var views = [];\n\n            if (_this10.tableExpandTabs.length > 0) {\n              var tabPanes = _this10.tableExpandTabs.map(function (tab) {\n                var errNum = tab.getErrorNum(sid);\n                return h(\"el-tab-pane\", {\n                  \"attrs\": {\n                    \"name\": tab.name\n                  }\n                }, [h(\"span\", {\n                  \"slot\": \"label\"\n                }, [tab.title, errNum > 0 && h(\"el-badge\", {\n                  \"attrs\": {\n                    \"value\": errNum\n                  }\n                })]), tab.options.map(function (o) {\n                  return h(\"uci-form-item\", {\n                    \"attrs\": {\n                      \"option\": o,\n                      \"sid\": sid\n                    }\n                  });\n                })]);\n              });\n\n              views.push(h(\"el-tabs\", {\n                \"attrs\": {\n                  \"value\": _this10.tabs[0].name\n                }\n              }, [tabPanes]));\n            }\n\n            var noTabOptions = _this10.arrayedTableExpandOptions.filter(function (o) {\n              return !o.tabName;\n            });\n\n            views.push(noTabOptions.map(function (o) {\n              return h(\"uci-form-item\", {\n                \"attrs\": {\n                  \"option\": o,\n                  \"sid\": sid\n                }\n              });\n            }));\n            return views;\n          }\n        };\n        columns.push(h(\"el-table-column\", {\n          \"attrs\": {\n            \"type\": \"expand\"\n          },\n          \"scopedSlots\": scopedSlots\n        }));\n      }\n\n      columns.push.apply(columns, _toConsumableArray(this.arrayedOptions.map(function (o) {\n        var scopedSlots = {\n          default: function _default(props) {\n            return h(\"uci-form-item\", {\n              \"attrs\": {\n                \"option\": o,\n                \"sid\": props.row,\n                \"table\": true\n              }\n            });\n          }\n        };\n        return h(\"el-table-column\", {\n          \"attrs\": {\n            \"label\": o.label,\n            \"width\": o.width\n          },\n          \"scopedSlots\": scopedSlots\n        });\n      })));\n      var actionWidth = 0;\n      if (this.addable && this.type && !this.name) actionWidth += 60;\n      if (this.sortable) actionWidth += 100;\n\n      if (actionWidth > 0) {\n        var _scopedSlots = {\n          default: function _default(props) {\n            var actions = [];\n\n            if (_this10.sortable) {\n              actions.push(h(\"el-button\", {\n                \"attrs\": {\n                  \"type\": \"success\",\n                  \"size\": \"mini\"\n                },\n                \"on\": {\n                  \"click\": _this10.handleSort.bind(_this10, props.row, true)\n                }\n              }, [\"\\u2191\"]));\n              actions.push(h(\"el-button\", {\n                \"attrs\": {\n                  \"type\": \"success\",\n                  \"size\": \"mini\"\n                },\n                \"on\": {\n                  \"click\": _this10.handleSort.bind(_this10, props.row, false)\n                }\n              }, [\"\\u2193\"]));\n            }\n\n            if (_this10.addable && _this10.type && !_this10.name) actions.push(h(\"el-button\", {\n              \"attrs\": {\n                \"type\": \"danger\",\n                \"size\": \"mini\"\n              },\n              \"on\": {\n                \"click\": _this10.del.bind(_this10, props.row)\n              }\n            }, [_this10.$t('Delete')]));\n            return h(\"el-button-group\", {\n              \"style\": \"margin-bottom: 22px\"\n            }, [actions]);\n          }\n        };\n        columns.push(h(\"el-table-column\", {\n          \"scopedSlots\": _scopedSlots,\n          \"attrs\": {\n            \"width\": actionWidth + 25\n          }\n        }));\n      }\n\n      return h(\"el-table\", {\n        \"attrs\": {\n          \"data\": this.sids\n        }\n      }, [columns]);\n    },\n    collapseView: function collapseView() {\n      var _this11 = this;\n\n      var h = this.$createElement;\n      var items = this.sids.map(function (sid) {\n        var title = [];\n\n        if (sid !== _this11.activeCollapseItem) {\n          var errNum = _this11.uciForm.getErrorNum(sid);\n\n          if (errNum > 0) title.push(h(\"el-badge\", {\n            \"attrs\": {\n              \"value\": errNum\n            }\n          }));\n\n          var teasersValue = _this11.teasersValue(sid);\n\n          var teasers = teasersValue.map(function (t, i) {\n            return \"\".concat(t[0], \": <strong>\").concat(t[1], \"</strong>\").concat(i < teasersValue.length - 1 ? ' | ' : '');\n          });\n          title.push(h(\"span\", {\n            \"domProps\": {\n              \"innerHTML\": teasers.join('')\n            }\n          }));\n        }\n\n        return h(\"el-collapse-item\", {\n          \"attrs\": {\n            \"title\": sid,\n            \"name\": sid\n          }\n        }, [h(\"div\", {\n          \"slot\": \"title\"\n        }, [title]), _this11.sectionView(sid)]);\n      });\n      return h(\"el-collapse\", {\n        \"attrs\": {\n          \"accordion\": true\n        },\n        \"model\": {\n          value: _this11.activeCollapseItem,\n          callback: function callback($$v) {\n            _this11.activeCollapseItem = $$v;\n          }\n        }\n      }, [items]);\n    },\n    view: function view() {\n      var _this12 = this;\n\n      var h = this.$createElement;\n      var view;\n      if (this.table) view = this.tableView();else if (this.collabsible && this.sids.length > 1) view = this.collapseView();else view = this.sids.map(function (sid) {\n        return _this12.sectionView(sid, _this12.addable);\n      });\n      if (this.addable && this.type && !this.name) return [view, h(\"uci-section-add\", {\n        \"attrs\": {\n          \"sestion\": this\n        }\n      })];else return view;\n    }\n  },\n  created: function created() {\n    this.uciForm.sections.push(this);\n    if (this.uciForm.loaded) this.load();\n  },\n  render: function render(h) {\n    return h('div', this.$slots.default);\n  }\n};",{"version":3,"sources":["D:\\Project VMODEV\\Horde\\oui\\oui-master\\oui-ui-core\\src\\src\\components\\uci-form\\src\\uci-section.js"],"names":["UciFormItem","UciSectionAdd","name","provide","uciSection","inject","props","type","String","title","addable","Boolean","anonymous","default","table","filter","Function","options","Object","add","afterAdd","beforeDel","collabsible","teasers","Array","sortable","components","data","loaded","tabs","children","sections","activeCollapseItem","computed","config","uciForm","tableExpandTabs","tab","isTableExpand","arrayedOptions","keys","map","sort","a","b","uid","o","arrayedTableExpandOptions","sids","s","tableActionWidthCalc","tableActionWidth","watch","load","methods","formValue","sid","undefined","setFormValue","val","addChild","$set","delChild","d","$delete","$uci","buildForm","destroyForm","destroyFormSid","loadAdded","performDel","del","before","window","oui","isPromise","then","swap","sid1","sid2","teasersValue","forEach","push","label","textValue","v","length","getErrorNum","validates","key","split","indexOf","valid","save","promises","p","_save","apply","_apply","applied","handleSort","up","index","nsid","sectionView","divider","views","bind","$t","tabPanes","errNum","noTabOptions","tabName","tableView","columns","scopedSlots","row","width","actionWidth","actions","collapseView","items","t","i","join","view","created","render","h","$slots"],"mappings":";;;;;;;AAAA,OAAOA,WAAP;AACA,OAAOC,aAAP;AAEA,eAAe;AACbC,EAAAA,IAAI,EAAE,YADO;AAEbC,EAAAA,OAFa,qBAEH;AACR,WAAO;AACLC,MAAAA,UAAU,EAAE;AADP,KAAP;AAGD,GANY;AAObC,EAAAA,MAAM,EAAE,CAAC,SAAD,CAPK;AAQbC,EAAAA,KAAK,EAAE;AACL;;;;;AAKAC,IAAAA,IAAI,EAAEC,MAND;AAOLN,IAAAA,IAAI,EAAEM,MAPD;AAQLC,IAAAA,KAAK,EAAED,MARF;;AASL;AACAE,IAAAA,OAAO,EAAEC,OAVJ;;AAWL;AACAC,IAAAA,SAAS,EAAE;AACTL,MAAAA,IAAI,EAAEI,OADG;AAETE,MAAAA,OAAO,EAAE;AAFA,KAZN;;AAgBL;AACAC,IAAAA,KAAK,EAAEH,OAjBF;;AAkBL;AACAI,IAAAA,MAAM,EAAEC,QAnBH;AAoBLC,IAAAA,OAAO,EAAE;AACPV,MAAAA,IAAI,EAAEW,MADC;AAEPL,MAAAA,OAAO,EAAE,oBAAM,CAAE;AAFV,KApBJ;;AAwBL;AACAM,IAAAA,GAAG,EAAEH,QAzBA;;AA0BL;AACAI,IAAAA,QAAQ,EAAEJ,QA3BL;;AA4BL;AACAK,IAAAA,SAAS,EAAEL,QA7BN;AA8BLM,IAAAA,WAAW,EAAE;AACXf,MAAAA,IAAI,EAAEI,OADK;AAEXE,MAAAA,OAAO,EAAE;AAFE,KA9BR;AAkCLU,IAAAA,OAAO,EAAEC,KAlCJ;AAmCLC,IAAAA,QAAQ,EAAEd;AAnCL,GARM;AA6Cbe,EAAAA,UAAU,EAAE;AACV1B,IAAAA,WAAW,EAAXA,WADU;AAEVC,IAAAA,aAAa,EAAbA;AAFU,GA7CC;AAiDb0B,EAAAA,IAjDa,kBAiDN;AACL,WAAO;AACLC,MAAAA,MAAM,EAAE,KADH;;AACU;AACfC,MAAAA,IAAI,EAAE,EAFD;;AAEK;AACVC,MAAAA,QAAQ,EAAE,EAHL;;AAGS;AACdC,MAAAA,QAAQ,EAAE,EAJL;;AAIS;AACdC,MAAAA,kBAAkB,EAAE;AALf,KAAP;AAOD,GAzDY;AA0DbC,EAAAA,QAAQ,EAAE;AACRC,IAAAA,MADQ,oBACC;AACP,aAAO,KAAKC,OAAL,CAAaD,MAApB;AACD,KAHO;AAIRE,IAAAA,eAJQ,6BAIU;AAChB,aAAO,KAAKP,IAAL,CAAUd,MAAV,CAAiB,UAAAsB,GAAG;AAAA,eAAIA,GAAG,CAACC,aAAR;AAAA,OAApB,CAAP;AACD,KANO;AAORC,IAAAA,cAPQ,4BAOS;AAAA;;AACf,aAAOrB,MAAM,CAACsB,IAAP,CAAY,KAAKV,QAAjB,EACJW,GADI,CACA,UAAAvC,IAAI;AAAA,eAAI,KAAI,CAAC4B,QAAL,CAAc5B,IAAd,CAAJ;AAAA,OADJ,EAEJwC,IAFI,CAEC,UAACC,CAAD,EAAIC,CAAJ;AAAA,eAAUD,CAAC,CAACE,GAAF,GAAQD,CAAC,CAACC,GAApB;AAAA,OAFD,EAGJ9B,MAHI,CAGG,UAAA+B,CAAC;AAAA,eAAI,CAACA,CAAC,CAACR,aAAP;AAAA,OAHJ,CAAP;AAID,KAZO;AAaRS,IAAAA,yBAbQ,uCAaoB;AAAA;;AAC1B,aAAO7B,MAAM,CAACsB,IAAP,CAAY,KAAKV,QAAjB,EACJW,GADI,CACA,UAAAvC,IAAI;AAAA,eAAI,MAAI,CAAC4B,QAAL,CAAc5B,IAAd,CAAJ;AAAA,OADJ,EAEJwC,IAFI,CAEC,UAACC,CAAD,EAAIC,CAAJ;AAAA,eAAUD,CAAC,CAACE,GAAF,GAAQD,CAAC,CAACC,GAApB;AAAA,OAFD,EAGJ9B,MAHI,CAGG,UAAA+B,CAAC;AAAA,eAAIA,CAAC,CAACR,aAAN;AAAA,OAHJ,CAAP;AAID,KAlBO;AAmBRU,IAAAA,IAnBQ,kBAmBD;AAAA;;AACL,UAAIjB,QAAQ,GAAG,EAAf;AAEA,UAAI,KAAK7B,IAAT,EACE6B,QAAQ,GAAG,KAAKA,QAAL,CAAchB,MAAd,CAAqB,UAAAkC,CAAC;AAAA,eAAIA,CAAC,CAAC,OAAD,CAAD,KAAe,MAAI,CAAC/C,IAAxB;AAAA,OAAtB,CAAX,CADF,KAEK,IAAI,KAAKK,IAAT,EACHwB,QAAQ,GAAG,KAAKA,QAAhB;AAEF,UAAI,KAAKhB,MAAT,EACEgB,QAAQ,GAAGA,QAAQ,CAAChB,MAAT,CAAgB,UAAAkC,CAAC;AAAA,eAAI,MAAI,CAAClC,MAAL,CAAYkC,CAAZ,EAAe,MAAf,CAAJ;AAAA,OAAjB,CAAX;AACF,aAAOlB,QAAQ,CAACU,GAAT,CAAa,UAAAQ,CAAC;AAAA,eAAIA,CAAC,CAAC,OAAD,CAAL;AAAA,OAAd,CAAP;AACD,KA9BO;AA+BRC,IAAAA,oBA/BQ,kCA+Be;AACrB,UAAI,KAAKC,gBAAT,EACE,OAAO,KAAKA,gBAAZ;AACF,UAAI,KAAK1B,QAAT,EACE,OAAO,KAAP;AACF,aAAO,IAAP;AACD;AArCO,GA1DG;AAiGb2B,EAAAA,KAAK,EAAE;AACL,oBADK,2BACc;AACjB,WAAKC,IAAL;AACD;AAHI,GAjGM;AAsGbC,EAAAA,OAAO,EAAE;AACPC,IAAAA,SADO,qBACGrD,IADH,EACSsD,GADT,EACc;AACnB,UAAMV,CAAC,GAAG,KAAKhB,QAAL,CAAc5B,IAAd,CAAV;AACA,UAAI4C,CAAJ,EACE,OAAOA,CAAC,CAACS,SAAF,CAAYC,GAAZ,CAAP;AACF,aAAOC,SAAP;AACD,KANM;AAOPC,IAAAA,YAPO,wBAOMxD,IAPN,EAOYsD,GAPZ,EAOiBG,GAPjB,EAOsB;AAC3B,UAAMb,CAAC,GAAG,KAAKhB,QAAL,CAAc5B,IAAd,CAAV;AACA,UAAI4C,CAAJ,EACEA,CAAC,CAACY,YAAF,CAAeF,GAAf,EAAoBG,GAApB;AACH,KAXM;AAYPC,IAAAA,QAZO,oBAYEd,CAZF,EAYK;AACV,WAAKe,IAAL,CAAU,KAAK/B,QAAf,EAAyBgB,CAAC,CAAC5C,IAA3B,EAAiC4C,CAAjC;AACD,KAdM;AAePgB,IAAAA,QAfO,oBAeEhB,CAfF,EAeK;AACV,UAAMiB,CAAC,GAAG,KAAKjC,QAAL,CAAcgB,CAAC,CAAC5C,IAAhB,CAAV;AACA,UAAI6D,CAAC,IAAIA,CAAC,CAAClB,GAAF,KAAUC,CAAC,CAACD,GAArB,EACE,KAAKmB,OAAL,CAAa,KAAKlC,QAAlB,EAA4BgB,CAAC,CAAC5C,IAA9B;AACH,KAnBM;AAoBPmD,IAAAA,IApBO,kBAoBA;AACL,WAAKtB,QAAL,GAAgB,KAAKkC,IAAL,CAAUlC,QAAV,CAAmB,KAAKG,MAAxB,EAAgC,KAAK3B,IAArC,CAAhB;AACA,WAAKqB,MAAL,GAAc,IAAd;AACD,KAvBM;AAwBPsC,IAAAA,SAxBO,qBAwBGV,GAxBH,EAwBQ;AACb,WAAK,IAAMtD,IAAX,IAAmB,KAAK4B,QAAxB;AACE,aAAKA,QAAL,CAAc5B,IAAd,EAAoBgE,SAApB,CAA8BV,GAA9B;AADF;AAED,KA3BM;AA4BPW,IAAAA,WA5BO,uBA4BKX,GA5BL,EA4BU;AACf,WAAK,IAAMtD,IAAX,IAAmB,KAAK4B,QAAxB;AACE,aAAKA,QAAL,CAAc5B,IAAd,EAAoBkE,cAApB,CAAmCZ,GAAnC;AADF;AAED,KA/BM;AAgCPa,IAAAA,SAhCO,qBAgCGb,GAhCH,EAgCQ;AACb,WAAKxB,kBAAL,GAA0BwB,GAA1B;AACA,WAAKH,IAAL;AACA,WAAKa,SAAL,CAAeV,GAAf;AACD,KApCM;AAqCPc,IAAAA,UArCO,sBAqCId,GArCJ,EAqCS;AACd,WAAKS,IAAL,CAAUM,GAAV,CAAc,KAAKrC,MAAnB,EAA2BsB,GAA3B;AACA,WAAKH,IAAL;AACA,WAAKc,WAAL,CAAiBX,GAAjB;AACD,KAzCM;AA0CPe,IAAAA,GA1CO,eA0CHf,GA1CG,EA0CE;AAAA;;AACP,UAAI,KAAKnC,SAAT,EAAoB;AAClB,YAAMmD,MAAM,GAAG,KAAKnD,SAAL,CAAemC,GAAf,EAAoB,IAApB,CAAf;AACA,YAAIgB,MAAM,KAAK,KAAf,EACE;;AAEF,YAAIC,MAAM,CAACC,GAAP,CAAWC,SAAX,CAAqBH,MAArB,CAAJ,EAAkC;AAChCA,UAAAA,MAAM,CAACI,IAAP,CAAY,YAAM;AAChB,YAAA,MAAI,CAACN,UAAL,CAAgBd,GAAhB;AACD,WAFD,EAEG,YAAM;AACP;AACD,WAJD;AAKA;AACD;AACF;;AACD,WAAKc,UAAL,CAAgBd,GAAhB;AACD,KA1DM;AA2DPqB,IAAAA,IA3DO,gBA2DFC,IA3DE,EA2DIC,IA3DJ,EA2DU;AACf,WAAKd,IAAL,CAAUY,IAAV,CAAe,KAAK3C,MAApB,EAA4B4C,IAA5B,EAAkCC,IAAlC;AACA,WAAK1B,IAAL;AACD,KA9DM;AA+DP2B,IAAAA,YA/DO,wBA+DMxB,GA/DN,EA+DW;AAAA;;AAChB,UAAMjC,OAAO,GAAG,EAAhB;;AAEA,UAAI,KAAKA,OAAT,EAAkB;AAChB,aAAKA,OAAL,CAAa0D,OAAb,CAAqB,UAAA/E,IAAI,EAAI;AAC3B,cAAM4C,CAAC,GAAG,MAAI,CAAChB,QAAL,CAAc5B,IAAd,CAAV;AACAqB,UAAAA,OAAO,CAAC2D,IAAR,CAAa,CAACpC,CAAC,CAACqC,KAAH,EAAUrC,CAAC,CAACsC,SAAF,CAAY5B,GAAZ,CAAV,CAAb;AACD,SAHD;AAID,OALD,MAKO;AACL,aAAK,IAAMtD,IAAX,IAAmB,KAAK4B,QAAxB,EAAkC;AAChC,cAAMgB,CAAC,GAAG,KAAKhB,QAAL,CAAc5B,IAAd,CAAV;AACA,cAAMmF,CAAC,GAAGvC,CAAC,CAACsC,SAAF,CAAY5B,GAAZ,CAAV;AACAjC,UAAAA,OAAO,CAAC2D,IAAR,CAAa,CAACpC,CAAC,CAACqC,KAAH,EAAUE,CAAV,CAAb;AACD;AACF;;AAED,UAAI9D,OAAO,CAAC+D,MAAR,GAAiB,CAArB,EACE/D,OAAO,CAACA,OAAO,CAAC+D,MAAR,GAAiB,CAAlB,CAAP,CAA4BJ,IAA5B,CAAiC,KAAjC;AAEF,aAAO3D,OAAP;AACD,KAnFM;AAoFPgE,IAAAA,WApFO,yBAoFO;AAAA;;AACZ,UAAMC,SAAS,GAAG,KAAKrD,OAAL,CAAaqD,SAA/B;AACA,UAAMhD,IAAI,GAAGtB,MAAM,CAACsB,IAAP,CAAYgD,SAAZ,EAAuBzE,MAAvB,CAA8B,UAAA0E,GAAG,EAAI;AAAA,yBAClCA,GAAG,CAACC,KAAJ,CAAU,GAAV,CADkC;AAAA;AAAA,YACzClC,GADyC;;AAEhD,eAAO,MAAI,CAACR,IAAL,CAAU2C,OAAV,CAAkBnC,GAAlB,IAAyB,CAAC,CAA1B,IAA+B,CAACgC,SAAS,CAACC,GAAD,CAAT,CAAeG,KAAtD;AACD,OAHY,CAAb;AAKA,aAAOpD,IAAI,CAAC8C,MAAZ;AACD,KA5FM;AA6FPO,IAAAA,IA7FO,kBA6FA;AAAA;;AACL,UAAMC,QAAQ,GAAG,EAAjB;AAEA,WAAK9C,IAAL,CAAUiC,OAAV,CAAkB,UAAAzB,GAAG,EAAI;AACvB,aAAK,IAAMtD,IAAX,IAAmB,MAAI,CAAC4B,QAAxB,EAAkC;AAChC,cAAMiE,CAAC,GAAG,MAAI,CAACjE,QAAL,CAAc5B,IAAd,EAAoB8F,KAApB,CAA0BxC,GAA1B,CAAV;;AACA,cAAIiB,MAAM,CAACC,GAAP,CAAWC,SAAX,CAAqBoB,CAArB,CAAJ,EACED,QAAQ,CAACZ,IAAT,CAAca,CAAd;AACH;AACF,OAND;AAQA,aAAOD,QAAP;AACD,KAzGM;AA0GPG,IAAAA,KA1GO,mBA0GC;AAAA;;AACN,UAAMH,QAAQ,GAAG,EAAjB;AAEA,WAAK9C,IAAL,CAAUiC,OAAV,CAAkB,UAAAzB,GAAG,EAAI;AACvB,aAAK,IAAMtD,IAAX,IAAmB,MAAI,CAAC4B,QAAxB,EAAkC;AAChC,cAAMiE,CAAC,GAAG,MAAI,CAACjE,QAAL,CAAc5B,IAAd,EAAoBgG,MAApB,CAA2B1C,GAA3B,CAAV;;AACA,cAAIiB,MAAM,CAACC,GAAP,CAAWC,SAAX,CAAqBoB,CAArB,CAAJ,EACED,QAAQ,CAACZ,IAAT,CAAca,CAAd;AACH;AACF,OAND;AAQA,aAAOD,QAAP;AACD,KAtHM;AAuHPK,IAAAA,OAvHO,qBAuHG;AAAA;;AACR,WAAKnD,IAAL,CAAUiC,OAAV,CAAkB,UAAAzB,GAAG,EAAI;AACvB,aAAK,IAAMtD,IAAX,IAAmB,MAAI,CAAC4B,QAAxB,EAAkC;AAChC,UAAA,MAAI,CAACA,QAAL,CAAc5B,IAAd,EAAoBiG,OAApB,CAA4B3C,GAA5B;AACD;AACF,OAJD;AAKD,KA7HM;AA8HP4C,IAAAA,UA9HO,sBA8HI5C,GA9HJ,EA8HS6C,EA9HT,EA8Ha;AAClB,UAAMrD,IAAI,GAAG,KAAKA,IAAlB;AACA,UAAIsD,KAAK,GAAGtD,IAAI,CAAC2C,OAAL,CAAanC,GAAb,CAAZ;AAEA,UAAI6C,EAAJ,EACEC,KAAK,GADP,KAGEA,KAAK;AAEP,UAAIA,KAAK,GAAG,CAAR,IAAaA,KAAK,KAAKtD,IAAI,CAACsC,MAAhC,EACE;AAEF,UAAMiB,IAAI,GAAGvD,IAAI,CAACsD,KAAD,CAAjB;AACA,WAAKzB,IAAL,CAAUrB,GAAV,EAAe+C,IAAf;AACD,KA5IM;AA6IPC,IAAAA,WA7IO,uBA6IKhD,GA7IL,EA6IUiD,OA7IV,EA6ImB;AAAA;AACxB,UAAMC,KAAK,GAAG,EAAd;AAEA,UAAI,KAAKhG,OAAL,IAAgB,KAAKH,IAArB,IAA6B,CAAC,KAAKL,IAAvC,EACEwG,KAAK,CAACxB,IAAN;AAAA,iBAAoC,aAApC;AAAA;AAAA,kBAAuD,QAAvD;AAAA,kBAAqE;AAArE;AAAA;AAAA,mBAAsF,KAAKX,GAAL,CAASoC,IAAT,CAAc,IAAd,EAAoBnD,GAApB;AAAtF;AAAA,UAAkH,KAAKoD,EAAL,CAAQ,QAAR,CAAlH;;AAEF,UAAI,KAAK/E,IAAL,CAAUyD,MAAV,GAAmB,CAAvB,EAA0B;AACxB,YAAMuB,QAAQ,GAAG,KAAKhF,IAAL,CAAUY,GAAV,CAAc,UAAAJ,GAAG,EAAI;AACpC,cAAMyE,MAAM,GAAGzE,GAAG,CAACkD,WAAJ,CAAgB/B,GAAhB,CAAf;AACA;AAAA;AAAA,sBACqBnB,GAAG,CAACnC;AADzB;AAAA;AAAA,oBAEe;AAFf,cAEyBmC,GAAG,CAAC5B,KAF7B,EAEqCqG,MAAM,GAAG,CAAT;AAAA;AAAA,uBAA+BA;AAA/B;AAAA,YAFrC,IAGMzE,GAAG,CAACpB,OAAJ,CAAYwB,GAAZ,CAAgB,UAAAK,CAAC;AAAA;AAAA;AAAA,0BAA2BA,CAA3B;AAAA,uBAAmCU;AAAnC;AAAA;AAAA,WAAjB,CAHN;AAMD,SARgB,CAAjB;AASAkD,QAAAA,KAAK,CAACxB,IAAN;AAAA;AAAA,qBAA2B,KAAKrD,IAAL,CAAU,CAAV,EAAa3B;AAAxC;AAAA,YAAgD2G,QAAhD;AACD;;AACD,UAAME,YAAY,GAAG,KAAKxE,cAAL,CAAoBxB,MAApB,CAA2B,UAAA+B,CAAC;AAAA,eAAI,CAACA,CAAC,CAACkE,OAAP;AAAA,OAA5B,CAArB;AACAN,MAAAA,KAAK,CAACxB,IAAN,CAAW6B,YAAY,CAACtE,GAAb,CAAiB,UAAAK,CAAC;AAAA;AAAA;AAAA,sBAA2BA,CAA3B;AAAA,mBAAmCU;AAAnC;AAAA;AAAA,OAAlB,CAAX;AAEA,UAAIiD,OAAJ,EACEC,KAAK,CAACxB,IAAN;AAEF,aAAOwB,KAAP;AACD,KAtKM;AAuKPO,IAAAA,SAvKO,uBAuKK;AAAA;;AAAA;AACV,UAAMC,OAAO,GAAG,EAAhB;AAEA;;AACA,UAAI,KAAK3E,cAAL,CAAoB+C,MAApB,GAA6B,CAAjC,EACE,OAAO7B,SAAP;;AAEF,UAAI,KAAKV,yBAAL,CAA+BuC,MAA/B,GAAwC,CAA5C,EAA+C;AAC7C,YAAM6B,WAAW,GAAG;AAClBtG,UAAAA,OAAO,EAAE,kBAAAP,KAAK,EAAI;AAChB,gBAAMkD,GAAG,GAAGlD,KAAK,CAAC8G,GAAlB;AACA,gBAAMV,KAAK,GAAG,EAAd;;AAEA,gBAAI,OAAI,CAACtE,eAAL,CAAqBkD,MAArB,GAA8B,CAAlC,EAAqC;AACnC,kBAAMuB,QAAQ,GAAG,OAAI,CAACzE,eAAL,CAAqBK,GAArB,CAAyB,UAAAJ,GAAG,EAAI;AAC/C,oBAAMyE,MAAM,GAAGzE,GAAG,CAACkD,WAAJ,CAAgB/B,GAAhB,CAAf;AACA;AAAA;AAAA,4BACqBnB,GAAG,CAACnC;AADzB;AAAA;AAAA,0BAEe;AAFf,oBAEyBmC,GAAG,CAAC5B,KAF7B,EAEqCqG,MAAM,GAAG,CAAT;AAAA;AAAA,6BAA+BA;AAA/B;AAAA,kBAFrC,IAGMzE,GAAG,CAACpB,OAAJ,CAAYwB,GAAZ,CAAgB,UAAAK,CAAC;AAAA;AAAA;AAAA,gCAA2BA,CAA3B;AAAA,6BAAmCU;AAAnC;AAAA;AAAA,iBAAjB,CAHN;AAMD,eARgB,CAAjB;;AASAkD,cAAAA,KAAK,CAACxB,IAAN;AAAA;AAAA,2BAA2B,OAAI,CAACrD,IAAL,CAAU,CAAV,EAAa3B;AAAxC;AAAA,kBAAgD2G,QAAhD;AACD;;AAED,gBAAME,YAAY,GAAG,OAAI,CAAChE,yBAAL,CAA+BhC,MAA/B,CAAsC,UAAA+B,CAAC;AAAA,qBAAI,CAACA,CAAC,CAACkE,OAAP;AAAA,aAAvC,CAArB;;AACAN,YAAAA,KAAK,CAACxB,IAAN,CAAW6B,YAAY,CAACtE,GAAb,CAAiB,UAAAK,CAAC;AAAA;AAAA;AAAA,4BAA2BA,CAA3B;AAAA,yBAAmCU;AAAnC;AAAA;AAAA,aAAlB,CAAX;AAEA,mBAAOkD,KAAP;AACD;AAtBiB,SAApB;AAyBAQ,QAAAA,OAAO,CAAChC,IAAR;AAAA;AAAA,oBAAmC;AAAnC;AAAA,yBAAyDiC;AAAzD;AACD;;AAEDD,MAAAA,OAAO,CAAChC,IAAR,OAAAgC,OAAO,qBAAS,KAAK3E,cAAL,CAAoBE,GAApB,CAAwB,UAAAK,CAAC,EAAI;AAC3C,YAAMqE,WAAW,GAAG;AAClBtG,UAAAA,OAAO,EAAE,kBAAAP,KAAK;AAAA;AAAA;AAAA,0BAA2BwC,CAA3B;AAAA,uBAAmCxC,KAAK,CAAC8G,GAAzC;AAAA,yBAAqD;AAArD;AAAA;AAAA;AADI,SAApB;AAGA;AAAA;AAAA,qBAA+BtE,CAAC,CAACqC,KAAjC;AAAA,qBAA+CrC,CAAC,CAACuE;AAAjD;AAAA,yBAAqEF;AAArE;AACD,OALe,CAAT,EAAP;AAOA,UAAIG,WAAW,GAAG,CAAlB;AACA,UAAI,KAAK5G,OAAL,IAAgB,KAAKH,IAArB,IAA6B,CAAC,KAAKL,IAAvC,EACEoH,WAAW,IAAI,EAAf;AACF,UAAI,KAAK7F,QAAT,EACE6F,WAAW,IAAI,GAAf;;AAEF,UAAIA,WAAW,GAAG,CAAlB,EAAqB;AACnB,YAAMH,YAAW,GAAG;AAClBtG,UAAAA,OAAO,EAAE,kBAAAP,KAAK,EAAI;AAChB,gBAAMiH,OAAO,GAAG,EAAhB;;AAEA,gBAAI,OAAI,CAAC9F,QAAT,EAAmB;AACjB8F,cAAAA,OAAO,CAACrC,IAAR;AAAA;AAAA,0BAA6B,SAA7B;AAAA,0BAA4C;AAA5C;AAAA;AAAA,2BAA6D,OAAI,CAACkB,UAAL,CAAgBO,IAAhB,CAAqB,OAArB,EAA2BrG,KAAK,CAAC8G,GAAjC,EAAsC,IAAtC;AAA7D;AAAA;AACAG,cAAAA,OAAO,CAACrC,IAAR;AAAA;AAAA,0BAA6B,SAA7B;AAAA,0BAA4C;AAA5C;AAAA;AAAA,2BAA6D,OAAI,CAACkB,UAAL,CAAgBO,IAAhB,CAAqB,OAArB,EAA2BrG,KAAK,CAAC8G,GAAjC,EAAsC,KAAtC;AAA7D;AAAA;AACD;;AAED,gBAAI,OAAI,CAAC1G,OAAL,IAAgB,OAAI,CAACH,IAArB,IAA6B,CAAC,OAAI,CAACL,IAAvC,EACEqH,OAAO,CAACrC,IAAR;AAAA;AAAA,wBAA6B,QAA7B;AAAA,wBAA2C;AAA3C;AAAA;AAAA,yBAA4D,OAAI,CAACX,GAAL,CAASoC,IAAT,CAAc,OAAd,EAAoBrG,KAAK,CAAC8G,GAA1B;AAA5D;AAAA,gBAA6F,OAAI,CAACR,EAAL,CAAQ,QAAR,CAA7F;AAEF;AAAA,uBAA8B;AAA9B,gBAAsDW,OAAtD;AACD;AAbiB,SAApB;AAeAL,QAAAA,OAAO,CAAChC,IAAR;AAAA,yBAA2CiC,YAA3C;AAAA;AAAA,qBAA+DG,WAAW,GAAG;AAA7E;AAAA;AACD;;AAED;AAAA;AAAA,kBAAuB,KAAKtE;AAA5B;AAAA,UAAmCkE,OAAnC;AACD,KA5OM;AA6OPM,IAAAA,YA7OO,0BA6OQ;AAAA;;AAAA;AACb,UAAMC,KAAK,GAAG,KAAKzE,IAAL,CAAUP,GAAV,CAAc,UAAAe,GAAG,EAAI;AACjC,YAAI/C,KAAK,GAAG,EAAZ;;AAEA,YAAI+C,GAAG,KAAK,OAAI,CAACxB,kBAAjB,EAAqC;AACnC,cAAM8E,MAAM,GAAG,OAAI,CAAC3E,OAAL,CAAaoD,WAAb,CAAyB/B,GAAzB,CAAf;;AACA,cAAIsD,MAAM,GAAG,CAAb,EACErG,KAAK,CAACyE,IAAN;AAAA;AAAA,uBAA4B4B;AAA5B;AAAA;;AAEF,cAAM9B,YAAY,GAAG,OAAI,CAACA,YAAL,CAAkBxB,GAAlB,CAArB;;AACA,cAAMjC,OAAO,GAAGyD,YAAY,CAACvC,GAAb,CAAiB,UAACiF,CAAD,EAAIC,CAAJ,EAAU;AACzC,6BAAUD,CAAC,CAAC,CAAD,CAAX,uBAA2BA,CAAC,CAAC,CAAD,CAA5B,sBAA2CC,CAAC,GAAG3C,YAAY,CAACM,MAAb,GAAsB,CAA1B,GAA8B,KAA9B,GAAsC,EAAjF;AACD,WAFe,CAAhB;AAGA7E,UAAAA,KAAK,CAACyE,IAAN;AAAA;AAAA,2BAAoC3D,OAAO,CAACqG,IAAR,CAAa,EAAb;AAApC;AAAA;AACD;;AAED;AAAA;AAAA,qBAC2BpE,GAD3B;AAAA,oBACsCA;AADtC;AAAA;AAAA,kBAEc;AAFd,YAEuB/C,KAFvB,IAGM,OAAI,CAAC+F,WAAL,CAAiBhD,GAAjB,CAHN;AAMD,OArBa,CAAd;AAuBA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAuC,OAAI,CAACxB,kBAA5C;AAAA;AAAuC,YAAA,OAAI,CAACA,kBAA5C;AAAA;AAAA;AAAA,UAAiEyF,KAAjE;AACD,KAtQM;AAuQPI,IAAAA,IAvQO,kBAuQA;AAAA;;AAAA;AACL,UAAIA,IAAJ;AAEA,UAAI,KAAK/G,KAAT,EACE+G,IAAI,GAAG,KAAKZ,SAAL,EAAP,CADF,KAEK,IAAI,KAAK3F,WAAL,IAAoB,KAAK0B,IAAL,CAAUsC,MAAV,GAAmB,CAA3C,EACHuC,IAAI,GAAG,KAAKL,YAAL,EAAP,CADG,KAGHK,IAAI,GAAG,KAAK7E,IAAL,CAAUP,GAAV,CAAc,UAAAe,GAAG;AAAA,eAAI,OAAI,CAACgD,WAAL,CAAiBhD,GAAjB,EAAsB,OAAI,CAAC9C,OAA3B,CAAJ;AAAA,OAAjB,CAAP;AAEF,UAAI,KAAKA,OAAL,IAAgB,KAAKH,IAArB,IAA6B,CAAC,KAAKL,IAAvC,EACE,OAAO,CAAC2H,IAAD;AAAA;AAAA,qBAAiC;AAAjC;AAAA,SAAP,CADF,KAGE,OAAOA,IAAP;AACH;AArRM,GAtGI;AA6XbC,EAAAA,OA7Xa,qBA6XH;AACR,SAAK3F,OAAL,CAAaJ,QAAb,CAAsBmD,IAAtB,CAA2B,IAA3B;AACA,QAAI,KAAK/C,OAAL,CAAaP,MAAjB,EACE,KAAKyB,IAAL;AACH,GAjYY;AAkYb0E,EAAAA,MAlYa,kBAkYNC,CAlYM,EAkYH;AACR,WAAOA,CAAC,CAAC,KAAD,EAAQ,KAAKC,MAAL,CAAYpH,OAApB,CAAR;AACD;AApYY,CAAf","sourcesContent":["import UciFormItem from './uci-form-item'\nimport UciSectionAdd from './uci-section-add'\n\nexport default {\n  name: 'UciSection',\n  provide() {\n    return {\n      uciSection: this\n    };\n  },\n  inject: ['uciForm'],\n  props: {\n    /*\n    ** The 'type' and 'name' must be provided at least one.\n    ** If the name prop is provided, only the section whose name is equal to the name prop is rendered,\n    ** otherwise render all sections whose type is equal to the type prop.\n    */\n    type: String,\n    name: String,\n    title: String,\n    /* The type prop must be provided for add or delete */\n    addable: Boolean,\n    /* If false, the add operation will add a named section */\n    anonymous: {\n      type: Boolean,\n      default: true\n    },\n    /* Render in a table */\n    table: Boolean,\n    /* Parameters: uci section, self */\n    filter: Function,\n    options: {\n      type: Object,\n      default: () => {}\n    },\n    /* Custom add function */\n    add: Function,\n    /* hook after add */\n    afterAdd: Function,\n    /* hook before del */\n    beforeDel: Function,\n    collabsible: {\n      type: Boolean,\n      default: true\n    },\n    teasers: Array,\n    sortable: Boolean\n  },\n  components: {\n    UciFormItem,\n    UciSectionAdd\n  },\n  data() {\n    return {\n      loaded: false, /* Indicates whether the data is loaded */\n      tabs: [], /* uci-tab vue instances */\n      children: {}, /* uci-option vue instances */\n      sections: [], /* uci sections */\n      activeCollapseItem: ''\n    }\n  },\n  computed: {\n    config() {\n      return this.uciForm.config;\n    },\n    tableExpandTabs() {\n      return this.tabs.filter(tab => tab.isTableExpand);\n    },\n    arrayedOptions() {\n      return Object.keys(this.children)\n        .map(name => this.children[name])\n        .sort((a, b) => a.uid - b.uid)\n        .filter(o => !o.isTableExpand);\n    },\n    arrayedTableExpandOptions() {\n      return Object.keys(this.children)\n        .map(name => this.children[name])\n        .sort((a, b) => a.uid - b.uid)\n        .filter(o => o.isTableExpand);\n    },\n    sids() {\n      let sections = [];\n\n      if (this.name)\n        sections = this.sections.filter(s => s['.name'] === this.name);\n      else if (this.type)\n        sections = this.sections;\n\n      if (this.filter)\n        sections = sections.filter(s => this.filter(s, this));\n      return sections.map(s => s['.name']);\n    },\n    tableActionWidthCalc() {\n      if (this.tableActionWidth)\n        return this.tableActionWidth;\n      if (this.sortable)\n        return '150';\n      return '70';\n    }\n  },\n  watch: {\n    'uciForm.loaded'() {\n      this.load();\n    }\n  },\n  methods: {\n    formValue(name, sid) {\n      const o = this.children[name];\n      if (o)\n        return o.formValue(sid);\n      return undefined;\n    },\n    setFormValue(name, sid, val) {\n      const o = this.children[name];\n      if (o)\n        o.setFormValue(sid, val);\n    },\n    addChild(o) {\n      this.$set(this.children, o.name, o);\n    },\n    delChild(o) {\n      const d = this.children[o.name];\n      if (d && d.uid === o.uid)\n        this.$delete(this.children, o.name);\n    },\n    load() {\n      this.sections = this.$uci.sections(this.config, this.type);\n      this.loaded = true;\n    },\n    buildForm(sid) {\n      for (const name in this.children)\n        this.children[name].buildForm(sid);\n    },\n    destroyForm(sid) {\n      for (const name in this.children)\n        this.children[name].destroyFormSid(sid);\n    },\n    loadAdded(sid) {\n      this.activeCollapseItem = sid;\n      this.load();\n      this.buildForm(sid);\n    },\n    performDel(sid) {\n      this.$uci.del(this.config, sid);\n      this.load();\n      this.destroyForm(sid);\n    },\n    del(sid) {\n      if (this.beforeDel) {\n        const before = this.beforeDel(sid, this);\n        if (before === false)\n          return;\n\n        if (window.oui.isPromise(before)) {\n          before.then(() => {\n            this.performDel(sid);\n          }, () => {\n            /* ignore promise rejection */\n          });\n          return;\n        }\n      }\n      this.performDel(sid);\n    },\n    swap(sid1, sid2) {\n      this.$uci.swap(this.config, sid1, sid2);\n      this.load();\n    },\n    teasersValue(sid) {\n      const teasers = [];\n\n      if (this.teasers) {\n        this.teasers.forEach(name => {\n          const o = this.children[name];\n          teasers.push([o.label, o.textValue(sid)]);\n        });\n      } else {\n        for (const name in this.children) {\n          const o = this.children[name];\n          const v = o.textValue(sid)\n          teasers.push([o.label, v]);\n        }\n      }\n\n      if (teasers.length > 0)\n        teasers[teasers.length - 1].push('end');\n\n      return teasers;\n    },\n    getErrorNum() {\n      const validates = this.uciForm.validates;\n      const keys = Object.keys(validates).filter(key => {\n        const [sid] = key.split('_');\n        return this.sids.indexOf(sid) > -1 && !validates[key].valid;\n      });\n\n      return keys.length;\n    },\n    save() {\n      const promises = [];\n\n      this.sids.forEach(sid => {\n        for (const name in this.children) {\n          const p = this.children[name]._save(sid);\n          if (window.oui.isPromise(p))\n            promises.push(p);\n        }\n      });\n\n      return promises;\n    },\n    apply() {\n      const promises = [];\n\n      this.sids.forEach(sid => {\n        for (const name in this.children) {\n          const p = this.children[name]._apply(sid);\n          if (window.oui.isPromise(p))\n            promises.push(p);\n        }\n      });\n\n      return promises;\n    },\n    applied() {\n      this.sids.forEach(sid => {\n        for (const name in this.children) {\n          this.children[name].applied(sid);\n        }\n      });\n    },\n    handleSort(sid, up) {\n      const sids = this.sids;\n      let index = sids.indexOf(sid);\n\n      if (up)\n        index--;\n      else\n        index++;\n\n      if (index < 0 || index === sids.length)\n        return;\n\n      const nsid = sids[index];\n      this.swap(sid, nsid);\n    },\n    sectionView(sid, divider) {\n      const views = [];\n\n      if (this.addable && this.type && !this.name)\n        views.push(<el-row><el-button style=\"float:right\" type=\"danger\" size=\"mini\" on-click={this.del.bind(this, sid)}>{ this.$t('Delete') }</el-button></el-row>);\n\n      if (this.tabs.length > 0) {\n        const tabPanes = this.tabs.map(tab => {\n          const errNum = tab.getErrorNum(sid);\n          return (\n            <el-tab-pane name={tab.name}>\n              <span slot=\"label\">{ tab.title }{errNum > 0 && <el-badge value={errNum} />}</span>\n              { tab.options.map(o => <uci-form-item option={o} sid={sid} />) }\n            </el-tab-pane>\n          );\n        });\n        views.push(<el-tabs value={this.tabs[0].name}>{ tabPanes }</el-tabs>);\n      }\n      const noTabOptions = this.arrayedOptions.filter(o => !o.tabName);\n      views.push(noTabOptions.map(o => <uci-form-item option={o} sid={sid} />));\n\n      if (divider)\n        views.push(<el-divider />);\n\n      return views;\n    },\n    tableView() {\n      const columns = [];\n\n      /* If don't do this, an exception occurs when rendering the expandable table. */\n      if (this.arrayedOptions.length < 1)\n        return undefined;\n\n      if (this.arrayedTableExpandOptions.length > 0) {\n        const scopedSlots = {\n          default: props => {\n            const sid = props.row;\n            const views = [];\n\n            if (this.tableExpandTabs.length > 0) {\n              const tabPanes = this.tableExpandTabs.map(tab => {\n                const errNum = tab.getErrorNum(sid);\n                return (\n                  <el-tab-pane name={tab.name}>\n                    <span slot=\"label\">{ tab.title }{errNum > 0 && <el-badge value={errNum} />}</span>\n                    { tab.options.map(o => <uci-form-item option={o} sid={sid} />) }\n                  </el-tab-pane>\n                );\n              });\n              views.push(<el-tabs value={this.tabs[0].name}>{ tabPanes }</el-tabs>);\n            }\n\n            const noTabOptions = this.arrayedTableExpandOptions.filter(o => !o.tabName);\n            views.push(noTabOptions.map(o => <uci-form-item option={o} sid={sid} />));\n\n            return views;\n          }\n        };\n\n        columns.push(<el-table-column type=\"expand\" scopedSlots={scopedSlots} />);\n      }\n\n      columns.push(...this.arrayedOptions.map(o => {\n        const scopedSlots = {\n          default: props => <uci-form-item option={o} sid={props.row} table={true} />\n        };\n        return <el-table-column label={o.label} width={o.width} scopedSlots={scopedSlots} />;\n      }));\n\n      let actionWidth = 0;\n      if (this.addable && this.type && !this.name)\n        actionWidth += 60;\n      if (this.sortable)\n        actionWidth += 100;\n\n      if (actionWidth > 0) {\n        const scopedSlots = {\n          default: props => {\n            const actions = [];\n\n            if (this.sortable) {\n              actions.push(<el-button type=\"success\" size=\"mini\" on-click={this.handleSort.bind(this, props.row, true)}>↑</el-button>);\n              actions.push(<el-button type=\"success\" size=\"mini\" on-click={this.handleSort.bind(this, props.row, false)}>↓</el-button>);\n            }\n\n            if (this.addable && this.type && !this.name)\n              actions.push(<el-button type=\"danger\" size=\"mini\" on-click={this.del.bind(this, props.row)}>{this.$t('Delete')}</el-button>);\n\n            return <el-button-group style=\"margin-bottom: 22px\">{ actions }</el-button-group>;\n          }\n        };\n        columns.push(<el-table-column scopedSlots={scopedSlots} width={actionWidth + 25} />);\n      }\n\n      return <el-table data={this.sids}>{columns}</el-table>;\n    },\n    collapseView() {\n      const items = this.sids.map(sid => {\n        let title = [];\n\n        if (sid !== this.activeCollapseItem) {\n          const errNum = this.uciForm.getErrorNum(sid);\n          if (errNum > 0)\n            title.push(<el-badge value={errNum} />);\n\n          const teasersValue = this.teasersValue(sid);\n          const teasers = teasersValue.map((t, i) => {\n            return `${t[0]}: <strong>${t[1]}</strong>${i < teasersValue.length - 1 ? ' | ' : ''}`;\n          });\n          title.push(<span domPropsInnerHTML={teasers.join('')}/>);\n        }\n\n        return (\n          <el-collapse-item title={sid} name={sid}>\n            <div slot=\"title\">{title}</div>\n            { this.sectionView(sid) }\n          </el-collapse-item>\n        );\n      });\n\n      return <el-collapse accordion v-model={this.activeCollapseItem}>{items}</el-collapse>;\n    },\n    view() {\n      let view;\n\n      if (this.table)\n        view = this.tableView();\n      else if (this.collabsible && this.sids.length > 1)\n        view = this.collapseView();\n      else\n        view = this.sids.map(sid => this.sectionView(sid, this.addable));\n\n      if (this.addable && this.type && !this.name)\n        return [view, <uci-section-add sestion={this} />];\n      else\n        return view;\n    }\n  },\n  created() {\n    this.uciForm.sections.push(this);\n    if (this.uciForm.loaded)\n      this.load();\n  },\n  render(h) {\n    return h('div', this.$slots.default);\n  }\n}\n"]}]}