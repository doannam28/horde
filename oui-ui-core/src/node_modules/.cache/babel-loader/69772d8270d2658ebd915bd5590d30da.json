{"remainingRequest":"D:\\Project VMODEV\\Horde\\horde-oui\\oui-ui-core\\src\\node_modules\\babel-loader\\lib\\index.js!D:\\Project VMODEV\\Horde\\horde-oui\\oui-ui-core\\src\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\Project VMODEV\\Horde\\horde-oui\\oui-ui-core\\src\\src\\plugins\\menu.js","dependencies":[{"path":"D:\\Project VMODEV\\Horde\\horde-oui\\oui-ui-core\\src\\src\\plugins\\menu.js","mtime":1591674512000},{"path":"D:\\Project VMODEV\\Horde\\horde-oui\\oui-ui-core\\src\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Project VMODEV\\Horde\\horde-oui\\oui-ui-core\\src\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\Project VMODEV\\Horde\\horde-oui\\oui-ui-core\\src\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.sort\";\nimport _objectSpread from \"D:\\\\Project VMODEV\\\\Horde\\\\horde-oui\\\\oui-ui-core\\\\src\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/objectSpread\";\nimport _slicedToArray from \"D:\\\\Project VMODEV\\\\Horde\\\\horde-oui\\\\oui-ui-core\\\\src\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/slicedToArray\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\nimport { ubus } from \"./ubus\";\nimport axios from 'axios';\nimport i18n from '@/i18n';\nvar menu = {};\n\nfunction parseMenus(raw) {\n  var menus = {};\n  Object.keys(raw).forEach(function (m) {\n    var paths = m.split('/');\n    if (paths.length === 1) menus[paths[0]] = raw[m];\n  });\n  Object.keys(raw).forEach(function (m) {\n    var _m$split = m.split('/'),\n        _m$split2 = _slicedToArray(_m$split, 2),\n        menu = _m$split2[0],\n        submenu = _m$split2[1];\n\n    if (submenu && menus[menu]) {\n      if (!menus[menu].children) menus[menu].children = {};\n      menus[menu].children[submenu] = raw[m];\n    }\n  });\n  menus = Object.keys(menus).map(function (k) {\n    return _objectSpread({\n      path: '/' + k\n    }, menus[k]);\n  });\n  menus.forEach(function (m) {\n    if (!m.children) return;\n    m.children = Object.keys(m.children).map(function (k) {\n      return _objectSpread({\n        path: \"\".concat(m.path, \"/\").concat(k)\n      }, m.children[k]);\n    });\n    m.children.sort(function (a, b) {\n      return a.index - b.index;\n    });\n  });\n  menus.sort(function (a, b) {\n    return a.index - b.index;\n  });\n  return menus.filter(function (m) {\n    return m.children;\n  });\n}\n\nfunction buildRoute(menu) {\n  if (menu.i18n) {\n    var msgs = menu.i18n;\n\n    for (var locale in msgs) {\n      i18n.mergeLocaleMessage(locale, msgs[locale]);\n    }\n  }\n\n  return {\n    path: menu.path,\n    component: function component(resolve) {\n      if (menu.plugin) {\n        axios.get(\"/views/\".concat(menu.view, \".js\")).then(function (r) {\n          resolve(eval(r.data));\n        });\n      } else {\n        return import(\"@/views/\".concat(menu.view));\n      }\n    },\n    meta: {\n      title: menu.title,\n      i18nfile: menu.i18nfile\n    },\n    beforeEnter: function beforeEnter(to, from, next) {\n      if (!to.meta.i18nfile) {\n        next();\n        return;\n      }\n\n      to.meta.i18nfile = false;\n      axios.get(\"/i18n\".concat(to.path, \".json\")).then(function (r) {\n        var msgs = r.data;\n\n        for (var _locale in msgs) {\n          i18n.mergeLocaleMessage(_locale, msgs[_locale]);\n        }\n\n        next();\n      }).catch(function () {\n        next();\n      });\n    }\n  };\n}\n\nfunction buildRoutes(menus) {\n  var routes = [];\n  menus.forEach(function (menu) {\n    var route = {\n      path: '/',\n      component: function component() {\n        return import('@/components/layout');\n      },\n      meta: {\n        title: menu.title\n      },\n      children: []\n    };\n\n    if (menu.view) {\n      route.redirect = menu.path;\n      route.children.push(buildRoute(menu));\n    } else if (menu.children) {\n      menu.children.forEach(function (sm) {\n        route.children.push(buildRoute(sm));\n      });\n    }\n\n    routes.push(route);\n  });\n  return routes;\n}\n\nmenu.load = function (cb) {\n  ubus.call('oui.ui', 'menu').then(function (r) {\n    var menus = parseMenus(r.menu);\n    var routes = buildRoutes(menus);\n    cb(menus, routes);\n  });\n};\n\nexport default {\n  install: function install(Vue) {\n    Vue.prototype.$menu = menu;\n  }\n};",{"version":3,"sources":["D:\\Project VMODEV\\Horde\\horde-oui\\oui-ui-core\\src\\src\\plugins\\menu.js"],"names":["ubus","axios","i18n","menu","parseMenus","raw","menus","Object","keys","forEach","m","paths","split","length","submenu","children","map","k","path","sort","a","b","index","filter","buildRoute","msgs","locale","mergeLocaleMessage","component","resolve","plugin","get","view","then","r","eval","data","meta","title","i18nfile","beforeEnter","to","from","next","catch","buildRoutes","routes","route","redirect","push","sm","load","cb","call","install","Vue","prototype","$menu"],"mappings":";;;;;;AAAA,SAAQA,IAAR;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,IAAP,MAAiB,QAAjB;AAEA,IAAMC,IAAI,GAAG,EAAb;;AAEA,SAASC,UAAT,CAAoBC,GAApB,EAAyB;AACvB,MAAIC,KAAK,GAAG,EAAZ;AAEAC,EAAAA,MAAM,CAACC,IAAP,CAAYH,GAAZ,EAAiBI,OAAjB,CAAyB,UAAAC,CAAC,EAAI;AAC5B,QAAMC,KAAK,GAAGD,CAAC,CAACE,KAAF,CAAQ,GAAR,CAAd;AACA,QAAID,KAAK,CAACE,MAAN,KAAiB,CAArB,EACEP,KAAK,CAACK,KAAK,CAAC,CAAD,CAAN,CAAL,GAAkBN,GAAG,CAACK,CAAD,CAArB;AACH,GAJD;AAMAH,EAAAA,MAAM,CAACC,IAAP,CAAYH,GAAZ,EAAiBI,OAAjB,CAAyB,UAAAC,CAAC,EAAI;AAAA,mBACJA,CAAC,CAACE,KAAF,CAAQ,GAAR,CADI;AAAA;AAAA,QACrBT,IADqB;AAAA,QACfW,OADe;;AAE5B,QAAIA,OAAO,IAAIR,KAAK,CAACH,IAAD,CAApB,EAA4B;AAC1B,UAAI,CAACG,KAAK,CAACH,IAAD,CAAL,CAAYY,QAAjB,EACET,KAAK,CAACH,IAAD,CAAL,CAAYY,QAAZ,GAAuB,EAAvB;AACFT,MAAAA,KAAK,CAACH,IAAD,CAAL,CAAYY,QAAZ,CAAqBD,OAArB,IAAgCT,GAAG,CAACK,CAAD,CAAnC;AACD;AACF,GAPD;AASAJ,EAAAA,KAAK,GAAGC,MAAM,CAACC,IAAP,CAAYF,KAAZ,EAAmBU,GAAnB,CAAuB,UAAAC,CAAC,EAAI;AAClC;AAAQC,MAAAA,IAAI,EAAE,MAAMD;AAApB,OAA0BX,KAAK,CAACW,CAAD,CAA/B;AACD,GAFO,CAAR;AAIAX,EAAAA,KAAK,CAACG,OAAN,CAAc,UAAAC,CAAC,EAAI;AACjB,QAAI,CAACA,CAAC,CAACK,QAAP,EACE;AAEFL,IAAAA,CAAC,CAACK,QAAF,GAAaR,MAAM,CAACC,IAAP,CAAYE,CAAC,CAACK,QAAd,EAAwBC,GAAxB,CAA4B,UAAAC,CAAC,EAAI;AAC5C;AAAQC,QAAAA,IAAI,YAAKR,CAAC,CAACQ,IAAP,cAAeD,CAAf;AAAZ,SAAmCP,CAAC,CAACK,QAAF,CAAWE,CAAX,CAAnC;AACD,KAFY,CAAb;AAIAP,IAAAA,CAAC,CAACK,QAAF,CAAWI,IAAX,CAAgB,UAACC,CAAD,EAAIC,CAAJ;AAAA,aAAUD,CAAC,CAACE,KAAF,GAAUD,CAAC,CAACC,KAAtB;AAAA,KAAhB;AACD,GATD;AAWAhB,EAAAA,KAAK,CAACa,IAAN,CAAW,UAACC,CAAD,EAAIC,CAAJ;AAAA,WAAUD,CAAC,CAACE,KAAF,GAAUD,CAAC,CAACC,KAAtB;AAAA,GAAX;AAEA,SAAOhB,KAAK,CAACiB,MAAN,CAAa,UAAAb,CAAC;AAAA,WAAIA,CAAC,CAACK,QAAN;AAAA,GAAd,CAAP;AACD;;AAED,SAASS,UAAT,CAAoBrB,IAApB,EAA0B;AACxB,MAAIA,IAAI,CAACD,IAAT,EAAe;AACb,QAAMuB,IAAI,GAAGtB,IAAI,CAACD,IAAlB;;AACA,SAAK,IAAMwB,MAAX,IAAqBD,IAArB;AACEvB,MAAAA,IAAI,CAACyB,kBAAL,CAAwBD,MAAxB,EAAgCD,IAAI,CAACC,MAAD,CAApC;AADF;AAED;;AAED,SAAO;AACLR,IAAAA,IAAI,EAAEf,IAAI,CAACe,IADN;AAELU,IAAAA,SAAS,EAAE,mBAAAC,OAAO,EAAI;AACpB,UAAI1B,IAAI,CAAC2B,MAAT,EAAiB;AACf7B,QAAAA,KAAK,CAAC8B,GAAN,kBAAoB5B,IAAI,CAAC6B,IAAzB,UAAoCC,IAApC,CAAyC,UAAAC,CAAC,EAAI;AAC5CL,UAAAA,OAAO,CAACM,IAAI,CAACD,CAAC,CAACE,IAAH,CAAL,CAAP;AACD,SAFD;AAGD,OAJD,MAIO;AACL,eAAO,yBAAkBjC,IAAI,CAAC6B,IAAvB,EAAP;AACD;AACF,KAVI;AAWLK,IAAAA,IAAI,EAAE;AACJC,MAAAA,KAAK,EAAEnC,IAAI,CAACmC,KADR;AAEJC,MAAAA,QAAQ,EAAEpC,IAAI,CAACoC;AAFX,KAXD;AAeLC,IAAAA,WAAW,EAAE,qBAACC,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAoB;AAC/B,UAAI,CAACF,EAAE,CAACJ,IAAH,CAAQE,QAAb,EAAuB;AACrBI,QAAAA,IAAI;AACJ;AACD;;AAEDF,MAAAA,EAAE,CAACJ,IAAH,CAAQE,QAAR,GAAmB,KAAnB;AAEAtC,MAAAA,KAAK,CAAC8B,GAAN,gBAAkBU,EAAE,CAACvB,IAArB,YAAkCe,IAAlC,CAAuC,UAAAC,CAAC,EAAI;AAC1C,YAAMT,IAAI,GAAGS,CAAC,CAACE,IAAf;;AACA,aAAK,IAAMV,OAAX,IAAqBD,IAArB;AACEvB,UAAAA,IAAI,CAACyB,kBAAL,CAAwBD,OAAxB,EAAgCD,IAAI,CAACC,OAAD,CAApC;AADF;;AAEAiB,QAAAA,IAAI;AACL,OALD,EAKGC,KALH,CAKS,YAAM;AACbD,QAAAA,IAAI;AACL,OAPD;AAQD;AA/BI,GAAP;AAiCD;;AAED,SAASE,WAAT,CAAqBvC,KAArB,EAA4B;AAC1B,MAAMwC,MAAM,GAAG,EAAf;AAEAxC,EAAAA,KAAK,CAACG,OAAN,CAAc,UAAAN,IAAI,EAAI;AACpB,QAAM4C,KAAK,GAAG;AACZ7B,MAAAA,IAAI,EAAE,GADM;AAEZU,MAAAA,SAAS,EAAE;AAAA,eAAM,OAAO,qBAAP,CAAN;AAAA,OAFC;AAGZS,MAAAA,IAAI,EAAE;AACJC,QAAAA,KAAK,EAAEnC,IAAI,CAACmC;AADR,OAHM;AAMZvB,MAAAA,QAAQ,EAAE;AANE,KAAd;;AASA,QAAIZ,IAAI,CAAC6B,IAAT,EAAe;AACbe,MAAAA,KAAK,CAACC,QAAN,GAAiB7C,IAAI,CAACe,IAAtB;AACA6B,MAAAA,KAAK,CAAChC,QAAN,CAAekC,IAAf,CAAoBzB,UAAU,CAACrB,IAAD,CAA9B;AACD,KAHD,MAGO,IAAIA,IAAI,CAACY,QAAT,EAAmB;AACxBZ,MAAAA,IAAI,CAACY,QAAL,CAAcN,OAAd,CAAsB,UAAAyC,EAAE,EAAI;AAC1BH,QAAAA,KAAK,CAAChC,QAAN,CAAekC,IAAf,CAAoBzB,UAAU,CAAC0B,EAAD,CAA9B;AACD,OAFD;AAGD;;AAEDJ,IAAAA,MAAM,CAACG,IAAP,CAAYF,KAAZ;AACD,GApBD;AAsBA,SAAOD,MAAP;AACD;;AAED3C,IAAI,CAACgD,IAAL,GAAY,UAASC,EAAT,EAAa;AACvBpD,EAAAA,IAAI,CAACqD,IAAL,CAAU,QAAV,EAAoB,MAApB,EAA4BpB,IAA5B,CAAiC,UAAAC,CAAC,EAAI;AACpC,QAAM5B,KAAK,GAAGF,UAAU,CAAC8B,CAAC,CAAC/B,IAAH,CAAxB;AACA,QAAM2C,MAAM,GAAGD,WAAW,CAACvC,KAAD,CAA1B;AACA8C,IAAAA,EAAE,CAAC9C,KAAD,EAAQwC,MAAR,CAAF;AACD,GAJD;AAKD,CAND;;AAQA,eAAe;AACbQ,EAAAA,OADa,mBACLC,GADK,EACA;AACXA,IAAAA,GAAG,CAACC,SAAJ,CAAcC,KAAd,GAAsBtD,IAAtB;AACD;AAHY,CAAf","sourcesContent":["import {ubus} from './ubus'\nimport axios from 'axios'\nimport i18n from '@/i18n'\n\nconst menu = {}\n\nfunction parseMenus(raw) {\n  let menus = {};\n\n  Object.keys(raw).forEach(m => {\n    const paths = m.split('/');\n    if (paths.length === 1)\n      menus[paths[0]] = raw[m];\n  });\n\n  Object.keys(raw).forEach(m => {\n    const [menu, submenu] = m.split('/');\n    if (submenu && menus[menu]) {\n      if (!menus[menu].children)\n        menus[menu].children = {};\n      menus[menu].children[submenu] = raw[m];\n    }\n  });\n\n  menus = Object.keys(menus).map(k => {\n    return {path: '/' + k, ...menus[k]};\n  });\n\n  menus.forEach(m => {\n    if (!m.children)\n      return;\n\n    m.children = Object.keys(m.children).map(k => {\n      return {path: `${m.path}/${k}`, ...m.children[k]};\n    });\n\n    m.children.sort((a, b) => a.index - b.index);\n  });\n\n  menus.sort((a, b) => a.index - b.index);\n\n  return menus.filter(m => m.children);\n}\n\nfunction buildRoute(menu) {\n  if (menu.i18n) {\n    const msgs = menu.i18n;\n    for (const locale in msgs)\n      i18n.mergeLocaleMessage(locale, msgs[locale]);\n  }\n\n  return {\n    path: menu.path,\n    component: resolve => {\n      if (menu.plugin) {\n        axios.get(`/views/${menu.view}.js`).then(r => {\n          resolve(eval(r.data));\n        });\n      } else {\n        return import(`@/views/${menu.view}`);\n      }\n    },\n    meta: {\n      title: menu.title,\n      i18nfile: menu.i18nfile\n    },\n    beforeEnter: (to, from, next) => {\n      if (!to.meta.i18nfile) {\n        next();\n        return;\n      }\n\n      to.meta.i18nfile = false;\n\n      axios.get(`/i18n${to.path}.json`).then(r => {\n        const msgs = r.data;\n        for (const locale in msgs)\n          i18n.mergeLocaleMessage(locale, msgs[locale]);\n        next();\n      }).catch(() => {\n        next();\n      });\n    }\n  };\n}\n\nfunction buildRoutes(menus) {\n  const routes = [];\n\n  menus.forEach(menu => {\n    const route = {\n      path: '/',\n      component: () => import('@/components/layout'),\n      meta: {\n        title: menu.title\n      },\n      children: []\n    };\n\n    if (menu.view) {\n      route.redirect = menu.path;\n      route.children.push(buildRoute(menu));\n    } else if (menu.children) {\n      menu.children.forEach(sm => {\n        route.children.push(buildRoute(sm));\n      });\n    }\n\n    routes.push(route);\n  });\n\n  return routes;\n}\n\nmenu.load = function(cb) {\n  ubus.call('oui.ui', 'menu').then(r => {\n    const menus = parseMenus(r.menu);\n    const routes = buildRoutes(menus);\n    cb(menus, routes);\n  });\n}\n\nexport default {\n  install(Vue) {\n    Vue.prototype.$menu = menu;\n  }\n}\n"]}]}