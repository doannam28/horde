{"remainingRequest":"D:\\Project VMODEV\\Horde\\horde-oui\\oui-ui-core\\src\\node_modules\\babel-loader\\lib\\index.js!D:\\Project VMODEV\\Horde\\horde-oui\\oui-ui-core\\src\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\Project VMODEV\\Horde\\horde-oui\\oui-ui-core\\src\\src\\plugins\\ubus.js","dependencies":[{"path":"D:\\Project VMODEV\\Horde\\horde-oui\\oui-ui-core\\src\\src\\plugins\\ubus.js","mtime":1591674512000},{"path":"D:\\Project VMODEV\\Horde\\horde-oui\\oui-ui-core\\src\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Project VMODEV\\Horde\\horde-oui\\oui-ui-core\\src\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\Project VMODEV\\Horde\\horde-oui\\oui-ui-core\\src\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _typeof from \"D:\\\\Project VMODEV\\\\Horde\\\\horde-oui\\\\oui-ui-core\\\\src\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/typeof\";\nimport axios from 'axios';\nimport { session } from \"./session\";\nexport var ubus = {\n  id: 1\n};\nvar ubusErrorInfo = {\n  0: 'Success',\n  1: 'Invalid command',\n  2: 'Invalid argument',\n  3: 'Method not found',\n  4: 'Not found',\n  5: 'No response',\n  6: 'Permission denied',\n  7: 'Request timed out',\n  8: 'Operation not supported',\n  9: 'Unknown error',\n  10: 'Connection failed'\n};\n\nubus._call = function (reqs, timeout) {\n  if (typeof timeout !== 'number' || timeout < 1) timeout = 10;\n  return new Promise(function (resolve, reject) {\n    axios.post('/ubus', reqs, {\n      timeout: timeout * 1000\n    }).then(function (response) {\n      var resp = response.data;\n\n      if (!Array.isArray(reqs)) {\n        reqs = [reqs];\n        resp = [resp];\n      }\n\n      var data = [];\n\n      for (var i = 0; i < resp.length; i++) {\n        var req = reqs[i];\n        if (_typeof(resp[i]) !== 'object' || resp[i].jsonrpc !== '2.0') throw 'ubus call error: Invalid msg';\n        if (resp[i].id !== reqs[i].id) throw 'No related request for JSON response';\n\n        if (_typeof(resp[i].error) === 'object') {\n          reject({\n            req: req.params.slice(1),\n            error: resp[i].error\n          });\n          return;\n        }\n\n        var result = resp[i].result;\n\n        if (!Array.isArray(result) || result.length < 1) {\n          if (reqs[i].method === 'call') {\n            throw 'Illegal response format';\n          }\n\n          result = [];\n        }\n\n        if (reqs[i].method === 'call') {\n          var code = result[0];\n\n          if (code !== 0) {\n            var message = ubusErrorInfo[code] || '';\n            reject({\n              req: req.params.slice(1),\n              error: {\n                code: code,\n                message: message\n              }\n            });\n            return;\n          }\n\n          result = result[1];\n        }\n\n        data.push(result);\n      }\n\n      if (data.length === 0) data = undefined;else if (data.length === 1) data = data[0];\n      resolve(data);\n    }).catch(function (error) {\n      reject(error);\n    });\n  });\n};\n\nubus._buildRequest = function (object, method, params) {\n  if (typeof params === 'undefined') params = {};\n  var req = {\n    jsonrpc: '2.0',\n    id: this.id++,\n    method: 'call',\n    params: [session.sid(), object, method, params]\n  };\n  return req;\n};\n\nubus.call = function (object, method, params, timeout) {\n  var req = this._buildRequest(object, method, params);\n\n  return this._call(req, timeout);\n};\n\nubus.callBatch = function (batchs, timeout) {\n  var _this = this;\n\n  var reqs = [];\n  batchs.forEach(function (item) {\n    var req = _this._buildRequest(item[0], item[1], item[2]);\n\n    reqs.push(req);\n  });\n  return this._call(reqs, timeout);\n};\n\nubus.list = function () {\n  var _arguments = arguments;\n  var params = Object.keys(arguments).map(function (k) {\n    return _arguments[k];\n  });\n  var req = {\n    jsonrpc: '2.0',\n    id: this.id++,\n    method: 'list',\n    params: params.length > 0 ? params : undefined\n  };\n  return this._call(req);\n};\n\nexport default {\n  install: function install(Vue) {\n    Vue.prototype.$ubus = ubus;\n  }\n};",{"version":3,"sources":["D:\\Project VMODEV\\Horde\\horde-oui\\oui-ui-core\\src\\src\\plugins\\ubus.js"],"names":["axios","session","ubus","id","ubusErrorInfo","_call","reqs","timeout","Promise","resolve","reject","post","then","response","resp","data","Array","isArray","i","length","req","jsonrpc","error","params","slice","result","method","code","message","push","undefined","catch","_buildRequest","object","sid","call","callBatch","batchs","forEach","item","list","Object","keys","arguments","map","k","install","Vue","prototype","$ubus"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport {session} from './session'\n\nexport const ubus = {\n  id: 1\n}\n\nconst ubusErrorInfo = {\n  0: 'Success',\n  1: 'Invalid command',\n  2: 'Invalid argument',\n  3: 'Method not found',\n  4: 'Not found',\n  5: 'No response',\n  6: 'Permission denied',\n  7: 'Request timed out',\n  8: 'Operation not supported',\n  9: 'Unknown error',\n  10: 'Connection failed'\n}\n\nubus._call = function(reqs, timeout) {\n  if (typeof(timeout) !== 'number' || timeout < 1)\n    timeout = 10;\n\n  return new Promise((resolve, reject) => {\n    axios.post('/ubus', reqs, {\n      timeout: timeout * 1000\n    }).then(response => {\n      let resp = response.data;\n\n      if (!Array.isArray(reqs)) {\n        reqs = [reqs];\n        resp = [resp];\n      }\n\n      let data = [];\n\n      for (let i = 0; i < resp.length; i++) {\n        const req = reqs[i];\n\n        if (typeof(resp[i]) !== 'object' || resp[i].jsonrpc !== '2.0')\n          throw 'ubus call error: Invalid msg';\n\n        if (resp[i].id !== reqs[i].id)\n          throw 'No related request for JSON response';\n\n        if (typeof(resp[i].error) === 'object') {\n          reject({req: req.params.slice(1), error: resp[i].error});\n          return;\n        }\n\n        let result = resp[i].result;\n\n        if (!Array.isArray(result) || result.length < 1) {\n          if (reqs[i].method === 'call') {\n            throw 'Illegal response format';\n          }\n          result = [];\n        }\n\n        if (reqs[i].method === 'call') {\n          const code = result[0];\n          if (code !== 0) {\n            const message = ubusErrorInfo[code] || '';\n            reject({req: req.params.slice(1), error: {code, message}});\n            return;\n          }\n          result = result[1];\n        }\n\n        data.push(result);\n      }\n\n      if (data.length === 0)\n        data = undefined;\n      else if (data.length === 1)\n        data = data[0];\n\n      resolve(data);\n    }).catch(error => {\n      reject(error);\n    });\n  });\n}\n\nubus._buildRequest = function(object, method, params) {\n  if (typeof(params) === 'undefined')\n    params = {};\n\n  const req = {\n    jsonrpc: '2.0',\n    id: this.id++,\n    method: 'call',\n    params:  [session.sid(), object, method, params]\n  };\n\n  return req;\n}\n\nubus.call = function(object, method, params, timeout) {\n  const req = this._buildRequest(object, method, params);\n  return this._call(req, timeout);\n}\n\nubus.callBatch = function(batchs, timeout) {\n  const reqs = [];\n\n  batchs.forEach(item => {\n    const req = this._buildRequest(item[0], item[1], item[2]);\n    reqs.push(req);\n  });\n\n  return this._call(reqs, timeout);\n}\n\nubus.list = function() {\n  const params = Object.keys(arguments).map(k => arguments[k]);\n  const req = {\n    jsonrpc: '2.0',\n    id: this.id++,\n    method: 'list',\n    params:  (params.length > 0) ? params : undefined\n  };\n\n  return this._call(req);\n}\n\nexport default {\n  install(Vue) {\n    Vue.prototype.$ubus = ubus;\n  }\n}\n"]}]}