{"remainingRequest":"D:\\Project VMODEV\\Horde\\oui\\oui-master\\oui-ui-core\\src\\node_modules\\babel-loader\\lib\\index.js!D:\\Project VMODEV\\Horde\\oui\\oui-master\\oui-ui-core\\src\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\Project VMODEV\\Horde\\oui\\oui-master\\oui-ui-core\\src\\src\\plugins\\session.js","dependencies":[{"path":"D:\\Project VMODEV\\Horde\\oui\\oui-master\\oui-ui-core\\src\\src\\plugins\\session.js","mtime":1591674512000},{"path":"D:\\Project VMODEV\\Horde\\oui\\oui-master\\oui-ui-core\\src\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Project VMODEV\\Horde\\oui\\oui-master\\oui-ui-core\\src\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\Project VMODEV\\Horde\\oui\\oui-master\\oui-ui-core\\src\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport { ubus } from \"./ubus\";\nimport { uci } from \"./uci\";\nvar DEFAULT_SESSION_ID = '00000000000000000000000000000000';\nexport var session = {\n  aclCache: null\n};\n\nsession.sid = function () {\n  return sessionStorage.getItem('sid') || DEFAULT_SESSION_ID;\n};\n\nsession.login = function (username, password) {\n  var _this = this;\n\n  return new Promise(function (resolve) {\n    if (!password) {\n      password = '';\n    }\n\n    ubus.call('session', 'login', {\n      username: username,\n      password: password\n    }).then(function (r) {\n      _this.startHeartbeat();\n\n      sessionStorage.setItem('sid', r.ubus_rpc_session);\n      resolve(true);\n    }).catch(function () {\n      resolve(false);\n    });\n  });\n};\n\nsession.logout = function () {\n  var _this2 = this;\n\n  return new Promise(function (resolve) {\n    ubus.call('session', 'destroy').then(function () {\n      resolve();\n    }).catch(function () {\n      resolve();\n    });\n\n    _this2.stopHeartbeat();\n\n    sessionStorage.removeItem('sid');\n  });\n};\n\nsession.access = function (scope, object, fun) {\n  var _this3 = this;\n\n  return new Promise(function (resolve) {\n    if (_this3.sid() === DEFAULT_SESSION_ID) {\n      resolve(false);\n      return;\n    }\n\n    if (uci.applying()) {\n      resolve(true);\n      return;\n    }\n\n    ubus.call('session', 'access', {\n      scope: scope,\n      object: object,\n      function: fun\n    }).then(function (r) {\n      resolve(r.access);\n    }).catch(function () {\n      resolve(false);\n    });\n  });\n};\n\nsession.isAlive = function () {\n  return this.access('ubus', 'session', 'access');\n};\n\nsession.get = function (cb) {\n  ubus.call('session', 'get').then(function (r) {\n    cb(r.values);\n  }).catch(function () {\n    cb();\n  });\n};\n\nsession.startHeartbeat = function () {\n  var _this4 = this;\n\n  if (typeof this._hearbeatInterval !== 'undefined') {\n    return;\n  }\n\n  this._hearbeatInterval = window.setInterval(function () {\n    _this4.isAlive().then(function (alive) {\n      if (!alive) {\n        _this4.logout();\n      }\n    });\n  }, 15000);\n};\n\nsession.stopHeartbeat = function () {\n  if (typeof this._hearbeatInterval !== 'undefined') {\n    window.clearInterval(this._hearbeatInterval);\n    delete this._hearbeatInterval;\n  }\n};\n\nsession.updateACLs = function () {\n  var _this5 = this;\n\n  return new Promise(function (resolve) {\n    ubus.call('session', 'access').then(function (acls) {\n      _this5.aclCache = acls || {};\n      resolve();\n    });\n  });\n};\n\nsession.hasACL = function (scope, object, func) {\n  var acls = this.aclCache;\n  if (typeof func === 'undefined') return acls && acls[scope] && acls[scope][object];\n  if (acls && acls[scope] && acls[scope][object]) for (var i = 0; i < acls[scope][object].length; i++) {\n    if (acls[scope][object][i] === func) return true;\n  }\n  return false;\n};\n\nexport default {\n  install: function install(Vue) {\n    Vue.prototype.$session = session;\n  }\n};",{"version":3,"sources":["D:\\Project VMODEV\\Horde\\oui\\oui-master\\oui-ui-core\\src\\src\\plugins\\session.js"],"names":["ubus","uci","DEFAULT_SESSION_ID","session","aclCache","sid","sessionStorage","getItem","login","username","password","Promise","resolve","call","then","r","startHeartbeat","setItem","ubus_rpc_session","catch","logout","stopHeartbeat","removeItem","access","scope","object","fun","applying","function","isAlive","get","cb","values","_hearbeatInterval","window","setInterval","alive","clearInterval","updateACLs","acls","hasACL","func","i","length","install","Vue","prototype","$session"],"mappings":";AAAA,SAAQA,IAAR;AACA,SAAQC,GAAR;AAEA,IAAMC,kBAAkB,GAAG,kCAA3B;AAEA,OAAO,IAAMC,OAAO,GAAG;AACrBC,EAAAA,QAAQ,EAAE;AADW,CAAhB;;AAIPD,OAAO,CAACE,GAAR,GAAc,YAAW;AACvB,SAAOC,cAAc,CAACC,OAAf,CAAuB,KAAvB,KAAiCL,kBAAxC;AACD,CAFD;;AAIAC,OAAO,CAACK,KAAR,GAAgB,UAASC,QAAT,EAAmBC,QAAnB,EAA6B;AAAA;;AAC3C,SAAO,IAAIC,OAAJ,CAAY,UAAAC,OAAO,EAAI;AAC5B,QAAI,CAACF,QAAL,EAAe;AACbA,MAAAA,QAAQ,GAAG,EAAX;AACD;;AAEDV,IAAAA,IAAI,CAACa,IAAL,CAAU,SAAV,EAAqB,OAArB,EAA8B;AAACJ,MAAAA,QAAQ,EAARA,QAAD;AAAWC,MAAAA,QAAQ,EAARA;AAAX,KAA9B,EAAoDI,IAApD,CAAyD,UAAAC,CAAC,EAAI;AAC5D,MAAA,KAAI,CAACC,cAAL;;AACAV,MAAAA,cAAc,CAACW,OAAf,CAAuB,KAAvB,EAA8BF,CAAC,CAACG,gBAAhC;AACAN,MAAAA,OAAO,CAAC,IAAD,CAAP;AACD,KAJD,EAIGO,KAJH,CAIS,YAAM;AACbP,MAAAA,OAAO,CAAC,KAAD,CAAP;AACD,KAND;AAOD,GAZM,CAAP;AAaD,CAdD;;AAgBAT,OAAO,CAACiB,MAAR,GAAiB,YAAW;AAAA;;AAC1B,SAAO,IAAIT,OAAJ,CAAY,UAAAC,OAAO,EAAI;AAC5BZ,IAAAA,IAAI,CAACa,IAAL,CAAU,SAAV,EAAqB,SAArB,EAAgCC,IAAhC,CAAqC,YAAM;AACzCF,MAAAA,OAAO;AACR,KAFD,EAEGO,KAFH,CAES,YAAM;AACbP,MAAAA,OAAO;AACR,KAJD;;AAMA,IAAA,MAAI,CAACS,aAAL;;AACAf,IAAAA,cAAc,CAACgB,UAAf,CAA0B,KAA1B;AACD,GATM,CAAP;AAUD,CAXD;;AAaAnB,OAAO,CAACoB,MAAR,GAAiB,UAASC,KAAT,EAAgBC,MAAhB,EAAwBC,GAAxB,EAA6B;AAAA;;AAC5C,SAAO,IAAIf,OAAJ,CAAY,UAAAC,OAAO,EAAI;AAC5B,QAAI,MAAI,CAACP,GAAL,OAAeH,kBAAnB,EAAuC;AACrCU,MAAAA,OAAO,CAAC,KAAD,CAAP;AACA;AACD;;AAED,QAAIX,GAAG,CAAC0B,QAAJ,EAAJ,EAAoB;AAClBf,MAAAA,OAAO,CAAC,IAAD,CAAP;AACA;AACD;;AAEDZ,IAAAA,IAAI,CAACa,IAAL,CAAU,SAAV,EAAqB,QAArB,EAA+B;AAACW,MAAAA,KAAK,EAALA,KAAD;AAAQC,MAAAA,MAAM,EAANA,MAAR;AAAgBG,MAAAA,QAAQ,EAAEF;AAA1B,KAA/B,EAA+DZ,IAA/D,CAAoE,UAAAC,CAAC,EAAI;AACvEH,MAAAA,OAAO,CAACG,CAAC,CAACQ,MAAH,CAAP;AACD,KAFD,EAEGJ,KAFH,CAES,YAAM;AACbP,MAAAA,OAAO,CAAC,KAAD,CAAP;AACD,KAJD;AAKD,GAhBM,CAAP;AAiBD,CAlBD;;AAoBAT,OAAO,CAAC0B,OAAR,GAAkB,YAAW;AAC3B,SAAO,KAAKN,MAAL,CAAY,MAAZ,EAAoB,SAApB,EAA+B,QAA/B,CAAP;AACD,CAFD;;AAIApB,OAAO,CAAC2B,GAAR,GAAc,UAASC,EAAT,EAAa;AACzB/B,EAAAA,IAAI,CAACa,IAAL,CAAU,SAAV,EAAqB,KAArB,EAA4BC,IAA5B,CAAiC,UAAAC,CAAC,EAAI;AACpCgB,IAAAA,EAAE,CAAChB,CAAC,CAACiB,MAAH,CAAF;AACD,GAFD,EAEGb,KAFH,CAES,YAAM;AACbY,IAAAA,EAAE;AACH,GAJD;AAKD,CAND;;AAQA5B,OAAO,CAACa,cAAR,GAAyB,YAAW;AAAA;;AAClC,MAAI,OAAO,KAAKiB,iBAAZ,KAAmC,WAAvC,EAAoD;AAClD;AACD;;AAED,OAAKA,iBAAL,GAAyBC,MAAM,CAACC,WAAP,CAAmB,YAAM;AAChD,IAAA,MAAI,CAACN,OAAL,GAAef,IAAf,CAAoB,UAAAsB,KAAK,EAAI;AAC3B,UAAI,CAACA,KAAL,EAAY;AACV,QAAA,MAAI,CAAChB,MAAL;AACD;AACF,KAJD;AAKD,GANwB,EAMtB,KANsB,CAAzB;AAOD,CAZD;;AAcAjB,OAAO,CAACkB,aAAR,GAAwB,YAAW;AACjC,MAAI,OAAO,KAAKY,iBAAZ,KAAmC,WAAvC,EAAoD;AAClDC,IAAAA,MAAM,CAACG,aAAP,CAAqB,KAAKJ,iBAA1B;AACA,WAAO,KAAKA,iBAAZ;AACD;AACF,CALD;;AAOA9B,OAAO,CAACmC,UAAR,GAAqB,YAAW;AAAA;;AAC9B,SAAO,IAAI3B,OAAJ,CAAY,UAAAC,OAAO,EAAI;AAC5BZ,IAAAA,IAAI,CAACa,IAAL,CAAU,SAAV,EAAqB,QAArB,EAA+BC,IAA/B,CAAoC,UAAAyB,IAAI,EAAI;AAC1C,MAAA,MAAI,CAACnC,QAAL,GAAgBmC,IAAI,IAAI,EAAxB;AACA3B,MAAAA,OAAO;AACR,KAHD;AAID,GALM,CAAP;AAMD,CAPD;;AASAT,OAAO,CAACqC,MAAR,GAAiB,UAAShB,KAAT,EAAgBC,MAAhB,EAAwBgB,IAAxB,EAA8B;AAC7C,MAAMF,IAAI,GAAG,KAAKnC,QAAlB;AAEA,MAAI,OAAOqC,IAAP,KAAiB,WAArB,EACE,OAAQF,IAAI,IAAIA,IAAI,CAACf,KAAD,CAAZ,IAAuBe,IAAI,CAACf,KAAD,CAAJ,CAAYC,MAAZ,CAA/B;AAEF,MAAIc,IAAI,IAAIA,IAAI,CAACf,KAAD,CAAZ,IAAuBe,IAAI,CAACf,KAAD,CAAJ,CAAYC,MAAZ,CAA3B,EACE,KAAK,IAAIiB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,IAAI,CAACf,KAAD,CAAJ,CAAYC,MAAZ,EAAoBkB,MAAxC,EAAgDD,CAAC,EAAjD;AACE,QAAIH,IAAI,CAACf,KAAD,CAAJ,CAAYC,MAAZ,EAAoBiB,CAApB,MAA2BD,IAA/B,EACE,OAAO,IAAP;AAFJ;AAIF,SAAO,KAAP;AACD,CAZD;;AAcA,eAAe;AACbG,EAAAA,OADa,mBACLC,GADK,EACA;AACXA,IAAAA,GAAG,CAACC,SAAJ,CAAcC,QAAd,GAAyB5C,OAAzB;AACD;AAHY,CAAf","sourcesContent":["import {ubus} from './ubus'\nimport {uci} from './uci'\n\nconst DEFAULT_SESSION_ID = '00000000000000000000000000000000'\n\nexport const session = {\n  aclCache: null\n}\n\nsession.sid = function() {\n  return sessionStorage.getItem('sid') || DEFAULT_SESSION_ID;\n}\n\nsession.login = function(username, password) {\n  return new Promise(resolve => {\n    if (!password) {\n      password = '';\n    }\n\n    ubus.call('session', 'login', {username, password}).then(r => {\n      this.startHeartbeat();\n      sessionStorage.setItem('sid', r.ubus_rpc_session);\n      resolve(true);\n    }).catch(() => {\n      resolve(false);\n    });\n  });\n}\n\nsession.logout = function() {\n  return new Promise(resolve => {\n    ubus.call('session', 'destroy').then(() => {\n      resolve();\n    }).catch(() => {\n      resolve();\n    });\n\n    this.stopHeartbeat();\n    sessionStorage.removeItem('sid');\n  });\n}\n\nsession.access = function(scope, object, fun) {\n  return new Promise(resolve => {\n    if (this.sid() === DEFAULT_SESSION_ID) {\n      resolve(false);\n      return;\n    }\n\n    if (uci.applying()) {\n      resolve(true);\n      return;\n    }\n\n    ubus.call('session', 'access', {scope, object, function: fun}).then(r => {\n      resolve(r.access);\n    }).catch(() => {\n      resolve(false);\n    });\n  });\n}\n\nsession.isAlive = function() {\n  return this.access('ubus', 'session', 'access');\n}\n\nsession.get = function(cb) {\n  ubus.call('session', 'get').then(r => {\n    cb(r.values);\n  }).catch(() => {\n    cb();\n  });\n}\n\nsession.startHeartbeat = function() {\n  if (typeof(this._hearbeatInterval) !== 'undefined') {\n    return;\n  }\n\n  this._hearbeatInterval = window.setInterval(() => {\n    this.isAlive().then(alive => {\n      if (!alive) {\n        this.logout();\n      }\n    });\n  }, 15000);\n}\n\nsession.stopHeartbeat = function() {\n  if (typeof(this._hearbeatInterval) !== 'undefined') {\n    window.clearInterval(this._hearbeatInterval);\n    delete this._hearbeatInterval;\n  }\n}\n\nsession.updateACLs = function() {\n  return new Promise(resolve => {\n    ubus.call('session', 'access').then(acls => {\n      this.aclCache = acls || {};\n      resolve();\n    });\n  });\n}\n\nsession.hasACL = function(scope, object, func) {\n  const acls = this.aclCache;\n\n  if (typeof(func) === 'undefined')\n    return (acls && acls[scope] && acls[scope][object]);\n\n  if (acls && acls[scope] && acls[scope][object])\n    for (let i = 0; i < acls[scope][object].length; i++)\n      if (acls[scope][object][i] === func)\n        return true;\n\n  return false;\n}\n\nexport default {\n  install(Vue) {\n    Vue.prototype.$session = session;\n  }\n}\n"]}]}